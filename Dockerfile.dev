FROM rust:1.78

WORKDIR /app

# Install cargo-watch for hot reloading
RUN cargo install cargo-watch

# Copy only the Cargo manifests first (for caching)
COPY Cargo.toml Cargo.lock ./

# Build dependencies
RUN mkdir src && echo "fn main() {}" > src/main.rs
RUN cargo fetch

# Remove the dummy source
RUN rm -r src

# Copy the source code
COPY . .

# Expose the application port
EXPOSE 8080

# Command to run the application with hot reloading
CMD ["cargo", "watch", "-x", "run"]

